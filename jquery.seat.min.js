/*seat v0.4 * sept 2012 * by scott * jonahshun@gmail.com */
(function(f){f.fn.seat=function(p){var p=f.extend({},f.fn.seat.settings,p);f.fn.seat.settings=p;return this.each(function(q){return new g(this,p)})};var k=(/android/gi).test(navigator.appVersion),l=(/iphone|ipad/gi).test(navigator.appVersion),i=(/hp-tablet/gi).test(navigator.appVersion),j="ontouchstart" in window&&!i,d=j?"touchstart":"mousedown",c=j?"touchmove":"mousemove",e=j?"touchend":"mouseup",b=j?"touchcancel":"mouseup",o=j?"touchstart":"click",n=0;var g=function(v,z){var v=f(v);v.addClass("ui-seat-area");var y=0,r=0,w=0,x=0,A=this,D,u=f.fn.seat.settings,C=z.data.area.areaid,q=z.data.area.venueid,F=u.bgcolor,B=u.totop*1;toleft=u.toleft*1;var E=function(J,K){var L=f("<div></div>");f.each(K.data.area.s,function(U){var V=this.v.split(",");var S=parseInt(V[3])*K.space-B;var T=parseInt(V[4])*K.space-toleft;var W=m.render({chairda:V,aid:C,vid:q});L.append(W);if(S>y){y=S}if(T>r){r=T}});J.append(L.children());r+=u.space,y+=u.space;J.attr("style","background-color:"+F+"; height:"+y+"px;width:"+r+"px;");f("html,body").animate({scrollTop:y/2,scrollLeft:r/2},500);var P=J.parent(),H=0,G=0,O=0,R=0;if(P.length>0){var I=P.width();var N=15;var Q=J;var M=0;P.bind(d,function(S){M=1;var T=j?(S.originalEvent.touches[0]||S.originalEvent.changedTouches[0]):S;H=parseInt(T.pageX);G=parseInt(T.pageY);O=parseInt(f(this).scrollLeft());R=parseInt(f("body").scrollTop())});P.bind(e,function(S){M=0});P.bind(b,function(S){M=0});P.bind("mouseout",function(S){M=0});P.bind(c,function(V){V.preventDefault();V.stopPropagation();if(M==0){return false}var Y=f(this);var X=j?(V.originalEvent.touches[0]||V.originalEvent.changedTouches[0]):V;var W=parseInt(Math.abs(X.pageY-G)),S=parseInt(Math.abs(X.pageX-H));if(S>=W){var U=O-(X.pageX-H);Y.scrollLeft(parseInt(U))}else{var T=R-(X.pageY-G);f("body").scrollTop(parseInt(T))}})}};var p=function(G,H){if(typeof(H)=="undefined"||H==""){window.clearTimeout(D)}else{f.getJSON(H,function(J){var I=J.data;G.attr("match","0");var K=a.run(I);f.each(I,function(O){var M=this.substring(0,1);var L=this.substring(1);var S=f("#s_"+L+"_"+J.areaid+"_"+J.venueid);S.attr("match","1");if(S.attr("flag")=="false"){var Q=(S.attr("xy")).split("|");var N=(S.attr("data")).split(",");var P=[L,N[1],M,Q[0],Q[1],N[3],N[4],N[5],"",5,J.areaid,""];var R=m.render({chairda:P,aid:J.areaid,vid:J.venueid});S.replaceWith(R)}})})}};E(v,z);var s=parseInt(f.fn.seat.settings.update.interval);var t=f.fn.seat.settings.update.url;if(s>0){D=setInterval(function(){p(v,t)},s)}return v};var m=function(){var w=function(x){var y=f(f.fn.seat.settings.tpl);y=r(x,y);return y};var u=function(){n=1};var v=function(x){x=j?x.originalEvent.touches[0]||x.originalEvent.changedTouches[0]:x;x.preventDefault();n=0};var q=function(D){if(j&&n==0){return false}var z=f.fn.seat.settings,C=z.seatcls.selected,y=z.seatcls.available,F=z.seatcls.tao,H=z.bgcolor;color_p=z.colorprice,limit=z.limit;limit=(limit*1)<0?6:parseInt(limit);var G=f(this).attr("data"),A="";if(!f(this).hasClass(C)){if(limit!=0&&h.data.length<limit){var E=y+" "+F;f(this).removeClass(E).addClass(C);f(this).attr("flag","true").css("background-color",H);h.add(G);A="add"}else{alert("Seat limited in "+limit)}}else{f(this).attr("flag","false");f(this).removeClass(C);if(f(this).attr("istao")=="1"){f(this).addClass(F)}else{f(this).addClass(y);var B=f(this).attr("data").split(",");f(this).css("background-color",color_p[B[1]])}h.del(G);f(this).attr("flag","false");A="del"}var x={da:G,act:A};f.fn.seat.settings.result(h.data,x);n=0};var t=function(x){alert(x)};var p=function(y,x){y.hover(function(){if(f(this).find(".title").length<1){f(this).append('<div class="title" style="position:relative;width:100px;height:20px;padding:0px;line-height:20px;text-align:center;top:-47px;left:-35px;background-color:#fff;border:1px solid #ccc;z-index:9999">'+x+"</div>")}else{f(this).find(".title").show()}},function(){f(this).find(".title").hide()});return y};var s=function(x){if(j){x.bind(d,u);x.bind(e,q);x.bind(c,v)}else{x.bind("click",q)}};var r=function(E,C){var D=E.chairda,z=f.fn.seat.settings,x=z.space,B=z.seatcls.available,F=z.seatcls.sold,G=z.seatcls.tao,I=z.title,J=z.bgcolor,H=z.totop*1;toleft=z.toleft*1,sTop=parseInt(D[3])*x-H,sLeft=parseInt(D[4])*x-toleft,sid="s_"+D[0]+"_"+E.aid+"_"+E.vid;if(typeof(D[2])=="undefined"){D[2]==0}var A=D[0]+","+D[1]+","+D[2]+","+D[5]+","+D[6]+","+D[7]+","+E.aid;C.addClass("ui-seat");C.attr("flag","false");switch(D[2]){case"2":var y=f.fn.seat.settings.colorprice[D[1]];C.css({top:sTop+"px",left:sLeft+"px","background-color":y});C.addClass(B);C.attr({id:sid,xy:D[3]+"|"+D[4],data:A});s(C);if(I==true){C=p(C,"Row "+D[5]+" NO "+D[6]+" ï¿¥"+D[7])}break;case"4":C.css({top:sTop+"px",left:sLeft+"px","background-color":J});C.addClass(G);A=A+",istao";C.attr({id:sid,xy:D[3]+"|"+D[4],istao:"1",taoid:D[9],data:A});s(C);if(I==true){C=p(C,"Row "+D[5]+" NO "+D[6]+" Season Ticket")}break;case"0":defualt:C.css({top:sTop,left:sLeft,"background-color":J});C.addClass(F);C.attr({id:sid,xy:D[3]+"|"+D[4],data:A});break}return C};return{render:function(x){return w(x)}}}();var a={run:function(r){this.data=new Object();var p=r.length;for(var q=0;q<p;q++){this.data[""+r[q].substring(1)]=r[q].substring(0,1)}},data:null};var h={add:function(p){if(f.inArray(p,this.data)==-1){this.data.push(p)}},del:function(q){var p=f.inArray(q,this.data);if(p>-1){this.data.splice(p,1)}},data:new Array()};f.fn.seat.settings={tpl:'<div class="tpl" style="background-color: black; width: 20px; height: 20px; "></div>',bgcolor:"#000",toleft:0,totop:0,data:{area:{fnames:"Stand 12",s:[{v:"1,0,0,7,44,1,1,1.00,0,0,0,"},{v:"2,0,0,7,39,1,2,1.00,0,0,0,"},{v:"3,0,0,8,44,2,1,1.00,0,0,0,"}]}},title:false,colorprice:["#FFFF00","#0101DF","#3ADF00","#FA5858"],mapurl:"http://www.gzhtml5.com",seatcls:{selected:"selected",available:"available",lock:"lock",sold:"sold",tao:"tao"},space:25,limit:6,result:function(p,q){},update:{interval:0,url:"js/update.json"}}})(jQuery);